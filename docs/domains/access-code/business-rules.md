# Access Code 비즈니스 규칙

## 1. 코드 생성 규칙

### 1.1 코드 형식
- 코드 길이: 6-12자리
- 문자셋: 영문 대문자, 숫자 조합
- 특수문자 제외
- 혼동되기 쉬운 문자 제외 (0, O, 1, I, L)

### 1.2 코드 유형별 규칙
1. 일회용 코드 (ONE_TIME)
   - 사용 즉시 만료
   - 최대 유효 시간: 30분
   - 재사용 불가

2. 시간 제한 코드 (TIME_LIMITED)
   - 발급 시점부터 지정된 시간까지 유효
   - 최소 유효 시간: 5분
   - 최대 유효 시간: 24시간
   - 유효 기간 내 다중 사용 가능

3. 다중 사용 코드 (MULTI_USE)
   - 최대 사용 횟수 지정 필수
   - 최소 사용 횟수: 2회
   - 최대 사용 횟수: 100회
   - 사용 횟수 초과 시 만료

## 2. 코드 검증 규칙

### 2.1 유효성 검증
1. 코드 형식 검증
   - 지정된 길이 준수
   - 허용된 문자셋만 포함
   - 대소문자 구분

2. 상태 검증
   - ACTIVE 상태만 사용 가능
   - USED, EXPIRED, REVOKED 상태는 사용 불가
   - 만료 시간 이전만 사용 가능

3. 사용자 검증
   - 발급된 사용자와 일치 여부 확인
   - 사용자 상태 활성화 여부 확인
   - IP 주소 및 기기 정보 기록

### 2.2 사용 제한
1. 시도 횟수 제한
   - 동일 코드 5회 연속 실패 시 해당 코드 만료
   - 동일 IP에서 1분당 최대 10회 시도
   - 동일 사용자 1분당 최대 5회 시도

2. 동시 사용 제한
   - 동일 코드 동시 사용 불가
   - 검증 요청 간 최소 1초 간격 필요

## 3. 정책 관리 규칙

### 3.1 정책 설정
1. 기본 정책
   - 모든 코드 유형별 기본 정책 필수
   - 기본 정책 비활성화 불가
   - 기본 정책 삭제 불가

2. 커스텀 정책
   - 활성화된 정책만 사용 가능
   - 정책 수정 시 기존 발급 코드 영향 없음
   - 정책 삭제 시 해당 정책으로 신규 코드 발급 불가

### 3.2 정책 제한
1. 보안 정책
   - 최소 코드 길이: 6자리
   - 최소 1개 이상의 숫자 포함
   - 최소 1개 이상의 영문자 포함

2. 운영 정책
   - 정책별 일일 최대 발급 수: 10,000건
   - 사용자별 일일 최대 발급 수: 10건
   - 정책 변경은 관리자 승인 필요

## 4. 이력 관리 규칙

### 4.1 생성 이력
- 코드 생성 시점
- 생성 요청자 정보
- 적용된 정책 정보
- 발급 대상 사용자 정보

### 4.2 사용 이력
- 사용 시점
- 사용자 정보
- IP 주소
- 기기 정보
- 사용 결과

### 4.3 만료 이력
- 만료 시점
- 만료 사유
- 마지막 사용 정보
- 총 사용 횟수

## 5. 알림 규칙

### 5.1 발송 규칙
- 코드 생성 즉시 알림 발송
- 알림 실패 시 최대 3회 재시도
- 재시도 간격: 1분
- 모든 재시도 실패 시 코드 만료

### 5.2 알림 채널
1. 이메일
   - HTML 형식 지원
   - 템플릿 필수 사용
   - 발신자 주소 고정

2. SMS
   - 텍스트만 허용
   - 최대 90자
   - 발신번호 고정

## 6. 변경 이력
| 버전 | 날짜 | 작성자 | 변경 내용 |
|-----|------|--------|-----------|
| 0.1.0 | 2025-03-16 | bok@weltcorp.com | 최초 작성 |